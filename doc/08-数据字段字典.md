# 婚庆管家 - 数据字段字典

**项目名称**: 婚庆管家（Wedding Host Manager）  
**版本**: v1.0.0  
**创建日期**: 2025-01-03

---

## 一、字段字典说明

本文档统一整理所有表的 status/type/flag 等枚举字段，明确：
- 枚举值定义
- 业务含义
- 是否支持逻辑删除
- 是否禁止随意修改
- 是否支持历史追溯

---

## 二、服务提供者相关表

### 2.1 wedding_service_provider（服务提供者表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| service_type | varchar(50) | host/photographer/butler | 服务类型：主持人/跟拍/管家（当前内置类型仅为系统初始化数据，非固定枚举） | ❌ | ✅ | ❌ |
| sex | tinyint(1) | 0=保密，1=男，2=女 | 性别 | ❌ | ❌ | ❌ |
| status | tinyint(1) | 0=禁用，1=正常 | 服务提供者状态 | ❌ | ❌ | ❌ |
| is_deleted | tinyint(1) | 0=否，1=是 | 逻辑删除标记 | ✅ | ❌ | ❌ |

### 2.2 wedding_service_provider_service（服务表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| type | tinyint(1) | 1=基础套餐，2=增值服务 | 服务类型 | ❌ | ❌ | ❌ |
| booking_mode | tinyint(1) | 1=分场次，2=全天 | 预定模式 | ❌ | ✅（有订单后） | ❌ |
| status | tinyint(1) | 0=禁用，1=正常 | 服务状态 | ❌ | ❌ | ❌ |

### 2.3 wedding_service_provider_schedule（档期表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| period | tinyint(1) | 1=早场，2=午场，3=晚场，4=全天 | 场次类型（推荐模板，系统业务判断以start_time+end_time为准） | ❌ | ✅ | ❌ |
| status | tinyint(1) | 0=空闲，1=休息，2=已预订 | 档期状态 | ❌ | ✅（需业务方法） | ❌ |

---

## 三、订单相关表

### 3.1 wedding_order（订单表）

**拆状态设计**：订单状态拆分为三个独立字段，避免单一字段过载。

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| order_status | smallint(4) | 0=待审核(CREATED)，1=已同意(CONFIRMED)，3=待服务(SERVING)，4=已完成(FINISHED)，10=已拒绝(REJECTED)，11=已取消(CANCELLED)，13=已关闭(CLOSED) | 订单业务主状态（生命周期） | ❌ | ✅（需状态流转） | ✅（通过order_status_log） |
| payment_status | tinyint(1) | 0=未付款(UNPAID)，1=已付款(PAID)，2=部分退款(PARTIAL_REFUND)，3=已退款(FULL_REFUND) | 支付状态（财务状态） | ❌ | ✅（需状态流转） | ✅（通过order_status_log） |
| refund_status | tinyint(1) | 0=无退款(NONE)，1=退款申请中(APPLY)，2=退款已同意(APPROVED)，3=退款已拒绝(REJECTED)，4=退款已完成(COMPLETED) | 退款状态（退款流程） | ❌ | ✅（需状态流转） | ✅（通过order_status_log） |

**状态组合规则**：
- 订单完整状态由 `order_status` + `payment_status` + `refund_status` 共同决定
- 详细状态组合规则见《00-系统设计总纲.md》状态机定义章节

**禁止随意修改字段**:
- `order_no`: 订单编号，创建后不可修改
- `order_status`: 必须通过状态流转方法修改
- `payment_status`: 必须通过状态流转方法修改
- `refund_status`: 必须通过状态流转方法修改
- `total_amount`: 创建后不可修改
- `create_time`: 创建时间，禁止修改

### 3.2 wedding_order_status_log（订单状态日志表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| from_status | tinyint(2) | 同order_status | 原状态 | ❌ | ✅ | ✅ |
| to_status | tinyint(2) | 同order_status | 新状态 | ❌ | ✅ | ✅ |
| operator_type | tinyint(1) | 0=系统，1=管理员，2=会员，3=服务提供者 | 操作人类型 | ❌ | ✅ | ✅ |

---

## 四、评价相关表

### 4.1 wedding_review（评价表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| status | tinyint(1) | 0=待审核，1=显示，2=隐藏 | 评价状态 | ❌ | ❌ | ❌ |
| is_anonymous | tinyint(1) | 0=否，1=是 | 是否匿名 | ❌ | ✅（创建后不可修改） | ❌ |

---

## 五、退款相关表

### 5.1 wedding_refund_apply（退款申请表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| refund_type | tinyint(1) | 1=用户申请，2=管理员操作 | 退款类型 | ❌ | ✅ | ❌ |
| status | tinyint(1) | 0=待审核，1=已同意，2=已拒绝，3=已完成 | 退款状态 | ❌ | ✅（需状态流转） | ❌ |

---

## 六、动态相关表

### 6.1 wedding_dynamic（动态表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| type | tinyint(1) | 1=图文，2=视频 | 动态类型 | ❌ | ✅（创建后不可修改） | ❌ |
| status | tinyint(1) | 0=待审核，1=已发布，2=已拒绝，3=已下架 | 动态状态 | ❌ | ❌ | ❌ |
| is_deleted | tinyint(1) | 0=否，1=是 | 逻辑删除标记 | ✅ | ❌ | ❌ |

### 6.2 wedding_dynamic_comment（动态评论表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| status | tinyint(1) | 0=待审核，1=已发布，2=已拒绝 | 评论状态 | ❌ | ❌ | ❌ |
| is_deleted | tinyint(1) | 0=否，1=是 | 逻辑删除标记 | ✅ | ❌ | ❌ |

---

## 七、用户与系统表

### 7.1 wedding_member（会员表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| sex | tinyint(1) | 0=未知，1=男，2=女 | 性别 | ❌ | ❌ | ❌ |
| is_provider | tinyint(1) | 0=否，1=是 | 是否服务提供者 | ❌ | ✅（需通过业务方法） | ❌ |
| status | tinyint(1) | 0=禁用，1=正常 | 会员状态 | ❌ | ❌ | ❌ |

### 7.2 wedding_admin（管理员表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| status | tinyint(1) | 0=禁用，1=正常 | 管理员状态 | ❌ | ❌ | ❌ |

---

## 八、内容管理表

### 8.1 wedding_notice（公告表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| target_type | tinyint(1) | 0=所有用户，1=普通用户，2=服务提供者 | 目标用户类型 | ❌ | ❌ | ❌ |
| is_top | tinyint(1) | 0=否，1=是 | 是否置顶 | ❌ | ❌ | ❌ |
| status | tinyint(1) | 0=禁用，1=启用 | 公告状态 | ❌ | ❌ | ❌ |

### 8.2 wedding_banner（轮播图表）

| 字段名 | 字段类型 | 枚举值 | 业务含义 | 逻辑删除 | 禁止修改 | 历史追溯 |
|-------|---------|--------|---------|---------|---------|---------|
| status | tinyint(1) | 0=禁用，1=启用 | 轮播图状态 | ❌ | ❌ | ❌ |

---

## 九、字段修改约束汇总

### 9.1 禁止随意修改的字段

| 表名 | 字段名 | 约束原因 |
|-----|-------|---------|
| wedding_order | order_no | 订单编号唯一标识，创建后不可修改 |
| wedding_order | order_status | 必须通过状态流转方法修改，确保状态机正确 |
| wedding_order | total_amount | 订单金额，创建后不可修改（需取消后重新创建） |
| wedding_order | create_time | 创建时间，禁止修改 |
| wedding_service_provider | service_type | 服务类型，创建后不可修改 |
| wedding_service_provider_service | booking_mode | 有订单关联后不可修改，避免历史数据不一致 |
| wedding_service_provider_service | price | 有订单关联后不可修改，需通过price_adjust调整 |
| wedding_service_provider_schedule | period | 场次类型，创建后不可修改 |
| wedding_review | is_anonymous | 匿名标记，创建后不可修改 |

### 9.2 必须通过业务方法修改的字段

| 表名 | 字段名 | 业务方法 |
|-----|-------|---------|
| wedding_order | order_status | OrderService::changeStatus() |
| wedding_service_provider_schedule | status | ScheduleService::updateStatus() |
| wedding_refund_apply | status | RefundService::changeStatus() |

---

## 十、逻辑删除支持汇总

| 表名 | 逻辑删除字段 | 说明 |
|-----|------------|------|
| wedding_service_provider | is_deleted | 支持逻辑删除，删除后数据保留 |
| wedding_dynamic | is_deleted | 支持逻辑删除，删除后数据保留 |
| wedding_dynamic_comment | is_deleted | 支持逻辑删除，删除后数据保留 |
| wedding_order | - | 不支持逻辑删除，终态订单永久保留用于历史追溯 |

---

## 十一、历史追溯支持汇总

| 表名 | 追溯方式 | 说明 |
|-----|---------|------|
| wedding_order | wedding_order_status_log | 所有状态变更记录在日志表 |
| wedding_order_status_log | - | 永久保留，用于状态变更历史查询 |

---

**文档版本**: v1.0.0  
**最后更新**: 2025-01-03

