# 婚庆管家 - 数据库设计文档

**项目名称**: 婚庆管家（Wedding Host Manager）  
**版本**: v1.0.0  
**创建日期**: 2025-12-31

---

## 一、数据库概述

### 1.1 数据库信息

- **数据库类型**: MySQL 5.7+
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_general_ci
- **表前缀**: wedding_
- **存储引擎**: InnoDB

### 1.2 表清单

| 序号 | 表名 | 说明 |
|-----|------|------|
| 1 | wedding_service_type | 服务类型表 |
| 2 | wedding_service_provider | 服务提供者表（统一表，包含主持人、跟拍、管家） |
| 3 | wedding_service_provider_label | 服务提供者标签表 |
| 4 | wedding_service_provider_service | 服务提供者服务表 |
| 5 | wedding_service_provider_schedule | 服务提供者档期表 |
| 6 | wedding_service_provider_favorite | 服务提供者收藏表 |
| 7 | wedding_order | 预约订单表 |
| 7 | wedding_order_period | 订单场次明细表 |
| 8 | wedding_order_option | 订单增值服务表 |
| 9 | wedding_order_status_log | 订单状态日志表 |
| 10 | wedding_review | 评价表 |
| 11 | wedding_refund_apply | 退款申请表 |
| 12 | wedding_dynamic | 动态表 |
| 13 | wedding_dynamic_comment | 动态评论表 |
| 14 | wedding_dynamic_like | 动态点赞表 |
| 15 | wedding_dynamic_category | 动态分类表 |
| 16 | wedding_member | 会员表 |
| 17 | wedding_admin | 管理员表 |
| 18 | wedding_config | 系统配置表 |
| 19 | wedding_diy_page | DIY页面表 |
| 20 | wedding_message | 消息表 |
| 21 | wedding_message_read | 消息已读记录表 |
| 22 | wedding_notice | 公告表 |
| 23 | wedding_banner | 轮播图表 |
| 24 | wedding_share_log | 分享记录表 |
| 25 | wedding_order_timeout_log | 订单超时日志表 |
| 26 | wedding_cart | 购物车表 |

---

## 二、核心业务表

### 2.1 服务类型表 (wedding_service_type)

```sql
CREATE TABLE `wedding_service_type` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `type_code` varchar(50) NOT NULL DEFAULT '' COMMENT '类型代码：host/photographer/butler',
    `type_name` varchar(50) NOT NULL DEFAULT '' COMMENT '类型名称：主持人/跟拍/管家',
    `icon` varchar(500) NOT NULL DEFAULT '' COMMENT '类型图标',
    `description` varchar(255) NOT NULL DEFAULT '' COMMENT '类型描述',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_type_code` (`type_code`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务类型表';
```

**预置数据**:
```sql
INSERT INTO `wedding_service_type` (`type_code`, `type_name`, `icon`, `description`, `sort`, `status`, `create_time`) VALUES
('host', '主持人', '', '婚礼主持人服务', 1, 1, UNIX_TIMESTAMP()),
('photographer', '跟拍', '', '婚礼跟拍服务', 2, 1, UNIX_TIMESTAMP()),
('butler', '管家', '', '婚礼管家服务', 3, 1, UNIX_TIMESTAMP());
```

### 2.2 服务提供者表 (wedding_service_provider)

**说明**: 统一的服务提供者表，包含主持人、跟拍、管家等所有服务类型。

```sql
CREATE TABLE `wedding_service_provider` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '关联会员ID',
    `service_type` varchar(50) NOT NULL DEFAULT 'host' COMMENT '服务类型：host/photographer/butler',
    `provider_no` varchar(32) NOT NULL DEFAULT '' COMMENT '服务提供者编号',
    `realname` varchar(50) NOT NULL DEFAULT '' COMMENT '真实姓名',
    `mobile` varchar(20) NOT NULL DEFAULT '' COMMENT '手机号码',
    `wechat` varchar(50) NOT NULL DEFAULT '' COMMENT '微信号',
    `headimg` varchar(500) NOT NULL DEFAULT '' COMMENT '头像',
    `cover` varchar(500) NOT NULL DEFAULT '' COMMENT '封面图',
    `sex` tinyint(1) NOT NULL DEFAULT 0 COMMENT '性别：0=保密，1=男，2=女',
    `birthday` varchar(20) NOT NULL DEFAULT '' COMMENT '出生日期',
    `id_card` varchar(30) NOT NULL DEFAULT '' COMMENT '身份证号',
    `signature` varchar(255) NOT NULL DEFAULT '' COMMENT '个性签名',
    `introduction` text COMMENT '个人介绍',
    `label_ids` varchar(255) NOT NULL DEFAULT '' COMMENT '标签ID，逗号分隔',
    `experience_years` int(10) NOT NULL DEFAULT 0 COMMENT '从业年限',
    `diy_page_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '关联DIY页面ID',
    
    -- 跟拍特有字段
    `equipment` varchar(500) NOT NULL DEFAULT '' COMMENT '设备清单（跟拍用）',
    `style_tags` varchar(255) NOT NULL DEFAULT '' COMMENT '风格标签（跟拍用）',
    
    -- 管家特有字段
    `service_scope` varchar(500) NOT NULL DEFAULT '' COMMENT '服务范围（管家用）',
    `team_size` int(10) NOT NULL DEFAULT 1 COMMENT '团队人数（管家用）',
    
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `order_count` int(10) NOT NULL DEFAULT 0 COMMENT '订单数量（缓存）',
    `review_count` int(10) NOT NULL DEFAULT 0 COMMENT '评价数量（缓存）',
    `avg_score` decimal(3,2) NOT NULL DEFAULT 5.00 COMMENT '平均评分（缓存）',
    `remark` varchar(500) NOT NULL DEFAULT '' COMMENT '备注',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    `is_deleted` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0=否，1=是',
    PRIMARY KEY (`id`),
    KEY `idx_member_id` (`member_id`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_status` (`status`),
    KEY `idx_diy_page_id` (`diy_page_id`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务提供者表（统一表）';
```

**说明**: 
- 统一使用`wedding_service_provider`表管理所有服务类型（主持人、跟拍、管家）
- 通过`service_type`字段区分不同的服务类型
- 如果已有`wedding_host`表数据，需要迁移到`wedding_service_provider`表（service_type='host'）
- 迁移完成后删除`wedding_host`表

### 2.4 服务提供者标签表 (wedding_service_provider_label)

**说明**: 
- 标签只能由管理员创建和管理
- 标签按服务类型区分，`service_type`为空表示通用标签（所有服务类型可用）
- 服务提供者不能自己设置标签，标签由管理员在编辑服务提供者时设置

```sql
CREATE TABLE `wedding_service_provider_label` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `service_type` varchar(50) NOT NULL DEFAULT '' COMMENT '服务类型：host/photographer/butler（空=通用标签，所有服务类型可用）',
    `name` varchar(50) NOT NULL DEFAULT '' COMMENT '标签名称',
    `icon` varchar(255) NOT NULL DEFAULT '' COMMENT '标签图标',
    `color` varchar(20) NOT NULL DEFAULT '' COMMENT '标签颜色',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务提供者标签表（仅管理员可管理）';
```

### 2.5 服务提供者服务表 (wedding_service_provider_service)

```sql
CREATE TABLE `wedding_service_provider_service` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `type` tinyint(1) NOT NULL DEFAULT 1 COMMENT '类型：1=基础套餐，2=增值服务',
    `title` varchar(100) NOT NULL DEFAULT '' COMMENT '服务名称',
    `description` varchar(500) NOT NULL DEFAULT '' COMMENT '服务描述',
    `price` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '价格',
    `period_prices` text COMMENT '场次价格配置（JSON）',
    `available_periods` varchar(50) NOT NULL DEFAULT '' COMMENT '可用场次（逗号分隔）',
    `booking_mode` tinyint(1) NOT NULL DEFAULT 1 COMMENT '预定模式：1=分场次，2=全天',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_provider_id` (`provider_id`),
    KEY `idx_type` (`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务提供者服务表';
```

**period_prices 字段说明**（JSON格式）:
```json
{
    "1": 2000.00,   // 场次1（早场/早司仪）价格
    "2": 2500.00,   // 场次2（午场/午宴）价格
    "3": 3000.00   // 场次3（晚场/晚宴）价格
}
```

### 2.6 服务提供者档期表 (wedding_service_provider_schedule)

```sql
CREATE TABLE `wedding_service_provider_schedule` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `date` date NOT NULL COMMENT '日期',
    `period` tinyint(1) NOT NULL DEFAULT 1 COMMENT '场次：1=早场（早司仪），2=午场（午宴），3=晚场（晚宴）（所有服务类型统一）',
    `status` tinyint(1) NOT NULL DEFAULT 0 COMMENT '状态：0=空闲，1=休息，2=已预订',
    `price_adjust` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '价格调整',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '关联订单ID',
    `remark` varchar(255) NOT NULL DEFAULT '' COMMENT '备注',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_provider_date_period` (`provider_id`, `date`, `period`),
    KEY `idx_date` (`date`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务提供者档期表';
```

### 2.7 服务提供者收藏表 (wedding_service_provider_favorite)

```sql
CREATE TABLE `wedding_service_provider_favorite` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_member_provider` (`member_id`, `provider_id`),
    KEY `idx_provider_id` (`provider_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='服务提供者收藏表';
```

---

## 三、订单相关表

### 3.1 预约订单表 (wedding_order)

```sql
CREATE TABLE `wedding_order` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_no` varchar(32) NOT NULL DEFAULT '' COMMENT '订单编号',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `service_type` varchar(50) NOT NULL DEFAULT 'host' COMMENT '服务类型：host/photographer/butler',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `reservation_date` date NOT NULL COMMENT '预约日期',
    
    -- 金额相关
    `total_amount` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '订单总额',
    
    -- 订单状态
    `order_status` tinyint(2) NOT NULL DEFAULT 0 COMMENT '订单状态：见状态说明',
    
    -- 联系信息
    `contact_name` varchar(50) NOT NULL DEFAULT '' COMMENT '联系人姓名',
    `contact_mobile` varchar(20) NOT NULL DEFAULT '' COMMENT '联系电话',
    `wedding_venue` varchar(255) NOT NULL DEFAULT '' COMMENT '婚礼场地',
    `remark` varchar(500) NOT NULL DEFAULT '' COMMENT '用户备注',
    
    -- 审核相关
    `approve_time` int(11) NOT NULL DEFAULT 0 COMMENT '审核时间',
    `reject_reason` varchar(500) NOT NULL DEFAULT '' COMMENT '拒绝原因',
    
    -- 付款相关
    `user_payment_voucher` varchar(500) NOT NULL DEFAULT '' COMMENT '用户上传的付款凭证图片',
    `payment_voucher` varchar(500) NOT NULL DEFAULT '' COMMENT '管理员确认的付款凭证图片',
    `payment_amount` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '实付金额',
    `payment_time` int(11) NOT NULL DEFAULT 0 COMMENT '付款确认时间',
    `payment_operator_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '付款确认人ID',
    `payment_remark` varchar(500) NOT NULL DEFAULT '' COMMENT '付款备注',
    
    -- 退款相关（管理员操作）
    `refund_voucher` varchar(500) NOT NULL DEFAULT '' COMMENT '退款凭证图片',
    `refund_amount` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '退款金额',
    `refund_time` int(11) NOT NULL DEFAULT 0 COMMENT '退款确认时间',
    `refund_operator_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '退款确认人ID',
    `refund_remark` varchar(500) NOT NULL DEFAULT '' COMMENT '退款备注',
    
    -- 完成相关
    `complete_time` int(11) NOT NULL DEFAULT 0 COMMENT '完成时间',
    `cancel_time` int(11) NOT NULL DEFAULT 0 COMMENT '取消时间',
    `cancel_reason` varchar(500) NOT NULL DEFAULT '' COMMENT '取消原因',
    
    -- 评价相关
    `is_reviewed` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否已评价：0=否，1=是',
    
    -- 快照数据
    `service_snapshot` text COMMENT '服务信息快照（JSON）',
    
    -- 其他
    `is_manual` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否手动创建：0=否，1=是',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_order_no` (`order_no`),
    KEY `idx_member_id` (`member_id`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_provider_id` (`provider_id`),
    KEY `idx_order_status` (`order_status`),
    KEY `idx_reservation_date` (`reservation_date`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='预约订单表';
```

**订单状态说明**:

| 状态值 | 状态名称 | 说明 |
|-------|---------|------|
| 0 | 待审核 | 用户提交订单，等待主持人审核 |
| 1 | 已同意 | 主持人同意，等待付款 |
| 2 | 已付款 | 管理员确认付款 |
| 3 | 待服务 | 付款后等待服务 |
| 4 | 已完成 | 服务完成 |
| 5 | 退款审核中 | 用户申请退款 |
| -1 | 已拒绝 | 服务提供者拒绝 |
| -2 | 已取消 | 用户取消 |
| -3 | 已退款 | 退款完成 |

**订单状态流转图**:
```
用户提交订单
    ↓
待审核(0) ─────────────────────────────────┐
    │                                      │
    │ [服务提供者同意]       [服务提供者拒绝]│
    ↓                                      ↓
已同意(1) ─────────────────────────────→ 已拒绝(-1)
    │                                      
    │ [管理员确认付款]                      
    ↓                                      
已付款(2)                                  
    │                                      
    ↓                                      
待服务(3) ─────────────────────────────┐   
    │                                  │   
    │ [服务完成]          [用户申请退款]│   
    ↓                                  ↓   
已完成(4)                     退款审核中(5)
                                       │   
                              [管理员确认退款]
                                       ↓   
                                  已退款(-3)

任意状态 ─→ [用户取消] ─→ 已取消(-2)
```

### 3.2 订单场次明细表 (wedding_order_period)

```sql
CREATE TABLE `wedding_order_period` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `period` tinyint(1) NOT NULL DEFAULT 1 COMMENT '场次：1=早场（早司仪），2=午场（午宴），3=晚场（晚宴）（所有服务类型统一）',
    `package_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '套餐ID',
    `package_title` varchar(100) NOT NULL DEFAULT '' COMMENT '套餐名称（快照）',
    `package_price` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '套餐价格（快照）',
    `price_adjust` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '档期价格调整',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_order_id` (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单场次明细表';
```

### 3.3 订单增值服务表 (wedding_order_option)

```sql
CREATE TABLE `wedding_order_option` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `service_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务ID',
    `service_title` varchar(100) NOT NULL DEFAULT '' COMMENT '服务名称（快照）',
    `service_price` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '服务单价（快照）',
    `apply_periods` varchar(50) NOT NULL DEFAULT '' COMMENT '应用场次（逗号分隔）',
    `period_count` int(10) NOT NULL DEFAULT 1 COMMENT '场次数量',
    `total_price` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '小计金额',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_order_id` (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单增值服务表';
```

### 3.4 订单状态日志表 (wedding_order_status_log)

```sql
CREATE TABLE `wedding_order_status_log` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `order_no` varchar(32) NOT NULL DEFAULT '' COMMENT '订单编号',
    `from_status` tinyint(2) NOT NULL DEFAULT 0 COMMENT '原状态',
    `to_status` tinyint(2) NOT NULL DEFAULT 0 COMMENT '新状态',
    `operator_type` tinyint(1) NOT NULL DEFAULT 0 COMMENT '操作人类型：0=系统，1=管理员，2=会员，3=主持人',
    `operator_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '操作人ID',
    `operator_name` varchar(50) NOT NULL DEFAULT '' COMMENT '操作人名称',
    `reason` varchar(500) NOT NULL DEFAULT '' COMMENT '变更原因',
    `remark` varchar(500) NOT NULL DEFAULT '' COMMENT '备注',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_order_id` (`order_id`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单状态日志表';
```

---

## 四、评价与退款表

### 4.1 评价表 (wedding_review)

```sql
CREATE TABLE `wedding_review` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `service_type` varchar(50) NOT NULL DEFAULT 'host' COMMENT '服务类型：host/photographer/butler',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `score` tinyint(1) NOT NULL DEFAULT 5 COMMENT '评分（1-5）',
    `content` text COMMENT '评价内容',
    `images` text COMMENT '评价图片（JSON数组）',
    `reply_content` text COMMENT '服务提供者回复',
    `reply_time` int(11) NOT NULL DEFAULT 0 COMMENT '回复时间',
    `is_anonymous` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否匿名：0=否，1=是',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=待审核，1=显示，2=隐藏',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_provider_id` (`provider_id`),
    KEY `idx_order_id` (`order_id`),
    KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评价表';
```

### 4.2 退款申请表 (wedding_refund_apply)

```sql
CREATE TABLE `wedding_refund_apply` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `refund_no` varchar(32) NOT NULL DEFAULT '' COMMENT '退款单号',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `order_no` varchar(32) NOT NULL DEFAULT '' COMMENT '订单编号',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `refund_amount` decimal(10,2) NOT NULL DEFAULT 0.00 COMMENT '申请退款金额',
    `refund_reason` varchar(500) NOT NULL DEFAULT '' COMMENT '退款原因',
    `refund_type` tinyint(1) NOT NULL DEFAULT 1 COMMENT '退款类型：1=用户申请，2=管理员操作',
    `status` tinyint(1) NOT NULL DEFAULT 0 COMMENT '状态：0=待审核，1=已同意，2=已拒绝，3=已完成',
    `audit_time` int(11) NOT NULL DEFAULT 0 COMMENT '审核时间',
    `audit_remark` varchar(500) NOT NULL DEFAULT '' COMMENT '审核备注',
    `complete_time` int(11) NOT NULL DEFAULT 0 COMMENT '完成时间',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_refund_no` (`refund_no`),
    KEY `idx_order_id` (`order_id`),
    KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='退款申请表';
```

---

## 五、动态相关表

### 5.1 动态表 (wedding_dynamic)

```sql
CREATE TABLE `wedding_dynamic` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `service_type` varchar(50) NOT NULL DEFAULT 'host' COMMENT '服务类型：host/photographer/butler',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '服务提供者ID',
    `category_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '分类ID',
    `type` tinyint(1) NOT NULL DEFAULT 1 COMMENT '类型：1=图文，2=视频',
    `content` text COMMENT '动态内容',
    `images` text COMMENT '图片列表（JSON数组）',
    `video` varchar(500) NOT NULL DEFAULT '' COMMENT '视频地址',
    `video_cover` varchar(500) NOT NULL DEFAULT '' COMMENT '视频封面',
    `video_duration` int(10) NOT NULL DEFAULT 0 COMMENT '视频时长（秒）',
    `view_count` int(10) NOT NULL DEFAULT 0 COMMENT '浏览量',
    `like_count` int(10) NOT NULL DEFAULT 0 COMMENT '点赞数',
    `comment_count` int(10) NOT NULL DEFAULT 0 COMMENT '评论数',
    `share_count` int(10) NOT NULL DEFAULT 0 COMMENT '分享数',
    `is_top` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否置顶：0=否，1=是',
    `top_time` int(11) NOT NULL DEFAULT 0 COMMENT '置顶时间',
    `status` tinyint(1) NOT NULL DEFAULT 0 COMMENT '状态：0=待审核，1=已发布，2=已拒绝，3=已下架',
    `reject_reason` varchar(500) NOT NULL DEFAULT '' COMMENT '拒绝原因',
    `audit_time` int(11) NOT NULL DEFAULT 0 COMMENT '审核时间',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    `is_deleted` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0=否，1=是',
    PRIMARY KEY (`id`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_provider_id` (`provider_id`),
    KEY `idx_category_id` (`category_id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态表';
```

### 5.2 动态分类表 (wedding_dynamic_category)

```sql
CREATE TABLE `wedding_dynamic_category` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `name` varchar(50) NOT NULL DEFAULT '' COMMENT '分类名称',
    `icon` varchar(255) NOT NULL DEFAULT '' COMMENT '分类图标',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态分类表';
```

### 5.3 动态评论表 (wedding_dynamic_comment)

```sql
CREATE TABLE `wedding_dynamic_comment` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `dynamic_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '动态ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '评论人ID',
    `parent_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '父评论ID（0=一级评论）',
    `reply_to_member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '回复的用户ID',
    `content` text COMMENT '评论内容',
    `like_count` int(10) NOT NULL DEFAULT 0 COMMENT '点赞数',
    `status` tinyint(1) NOT NULL DEFAULT 0 COMMENT '状态：0=待审核，1=已发布，2=已拒绝',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `is_deleted` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0=否，1=是',
    PRIMARY KEY (`id`),
    KEY `idx_dynamic_id` (`dynamic_id`),
    KEY `idx_member_id` (`member_id`),
    KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态评论表';
```

### 5.4 动态点赞表 (wedding_dynamic_like)

```sql
CREATE TABLE `wedding_dynamic_like` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `dynamic_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '动态ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_dynamic_member` (`dynamic_id`, `member_id`),
    KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态点赞表';
```

---

## 六、用户与系统表

### 6.1 会员表 (wedding_member)

```sql
CREATE TABLE `wedding_member` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `openid` varchar(64) NOT NULL DEFAULT '' COMMENT '微信OpenID',
    `unionid` varchar(64) NOT NULL DEFAULT '' COMMENT '微信UnionID',
    `nickname` varchar(50) NOT NULL DEFAULT '' COMMENT '昵称',
    `avatar` varchar(500) NOT NULL DEFAULT '' COMMENT '头像',
    `mobile` varchar(20) NOT NULL DEFAULT '' COMMENT '手机号',
    `sex` tinyint(1) NOT NULL DEFAULT 0 COMMENT '性别：0=未知，1=男，2=女',
    `is_provider` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否服务提供者：0=否，1=是',
    `service_type` varchar(50) NOT NULL DEFAULT '' COMMENT '服务类型：host/photographer/butler',
    `provider_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '关联服务提供者ID',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `last_login_time` int(11) NOT NULL DEFAULT 0 COMMENT '最后登录时间',
    `last_login_ip` varchar(50) NOT NULL DEFAULT '' COMMENT '最后登录IP',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_openid` (`openid`),
    KEY `idx_mobile` (`mobile`),
    KEY `idx_service_type` (`service_type`),
    KEY `idx_provider_id` (`provider_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会员表';
```

### 6.2 管理员表 (wedding_admin)

```sql
CREATE TABLE `wedding_admin` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `username` varchar(50) NOT NULL DEFAULT '' COMMENT '用户名',
    `password` varchar(255) NOT NULL DEFAULT '' COMMENT '密码',
    `realname` varchar(50) NOT NULL DEFAULT '' COMMENT '真实姓名',
    `mobile` varchar(20) NOT NULL DEFAULT '' COMMENT '手机号',
    `avatar` varchar(500) NOT NULL DEFAULT '' COMMENT '头像',
    `role` varchar(50) NOT NULL DEFAULT 'admin' COMMENT '角色',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=正常',
    `last_login_time` int(11) NOT NULL DEFAULT 0 COMMENT '最后登录时间',
    `last_login_ip` varchar(50) NOT NULL DEFAULT '' COMMENT '最后登录IP',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='管理员表';
```

### 6.3 系统配置表 (wedding_config)

```sql
CREATE TABLE `wedding_config` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `key` varchar(100) NOT NULL DEFAULT '' COMMENT '配置键',
    `value` text COMMENT '配置值',
    `description` varchar(255) NOT NULL DEFAULT '' COMMENT '配置说明',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_key` (`key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

### 6.4 DIY页面表 (wedding_diy_page)

```sql
CREATE TABLE `wedding_diy_page` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `title` varchar(100) NOT NULL DEFAULT '' COMMENT '页面标题',
    `name` varchar(100) NOT NULL DEFAULT '' COMMENT '页面标识（唯一）',
    `type` varchar(50) NOT NULL DEFAULT 'HOST_DETAIL' COMMENT '页面类型：HOST_DETAIL=主持人详情页',
    `mode` varchar(20) NOT NULL DEFAULT 'diy' COMMENT '页面模式：diy=自定义，fixed=固定',
    `host_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '关联主持人ID（HOST_DETAIL类型时）',
    `value` longtext COMMENT '页面数据（JSON格式，包含组件配置）',
    `cover` varchar(500) NOT NULL DEFAULT '' COMMENT '页面封面图',
    `preview` varchar(500) NOT NULL DEFAULT '' COMMENT '页面预览图',
    `is_default` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否默认模板：0=否，1=是',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=启用',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_name` (`name`),
    KEY `idx_host_id` (`host_id`),
    KEY `idx_type` (`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='DIY页面表';
```

**value字段说明**（JSON格式）:
```json
{
    "global": {
        "title": "主持人详情",
        "pageStartBgColor": "#F8F8F8",
        "pageEndBgColor": "",
        "pageGradientAngle": "to bottom",
        "bgUrl": ""
    },
    "value": [
        {
            "id": "unique_id",
            "componentName": "HostMediaCarousel",
            "componentTitle": "媒体轮播",
            "value": {
                // 组件配置数据
            },
            "template": {
                // 组件样式配置
            }
        }
    ]
}
```

**预置配置项**:

| key | 说明 | 示例值 |
|-----|------|-------|
| basic_config | 基础配置 | {"site_name": "婚庆管家"} |
| order_config | 订单配置 | {"auto_cancel_hours": 24, "timeout_reject_hours": 48} |
| review_config | 评价配置 | {"need_audit": true} |
| dynamic_config | 动态配置 | {"need_audit": true} |
| message_config | 消息配置 | {"enable_notify": true} |

---

## 七、消息与内容管理表

### 7.1 消息表 (wedding_message)

```sql
CREATE TABLE `wedding_message` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '接收会员ID（0=全体用户）',
    `type` varchar(50) NOT NULL DEFAULT '' COMMENT '消息类型：order_status/order_timeout/review_reply/system_notice',
    `title` varchar(255) NOT NULL DEFAULT '' COMMENT '消息标题',
    `content` text COMMENT '消息内容',
    `link_type` varchar(50) NOT NULL DEFAULT '' COMMENT '链接类型：order/dynamic/host/none',
    `link_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '链接ID',
    `link_url` varchar(500) NOT NULL DEFAULT '' COMMENT '链接地址',
    `is_read` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否已读：0=否，1=是（针对全体消息）',
    `read_count` int(10) NOT NULL DEFAULT 0 COMMENT '已读人数（针对全体消息）',
    `send_time` int(11) NOT NULL DEFAULT 0 COMMENT '发送时间',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_member_id` (`member_id`),
    KEY `idx_type` (`type`),
    KEY `idx_send_time` (`send_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息表';
```

### 7.2 消息已读记录表 (wedding_message_read)

```sql
CREATE TABLE `wedding_message_read` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `message_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '消息ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '会员ID',
    `read_time` int(11) NOT NULL DEFAULT 0 COMMENT '阅读时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_message_member` (`message_id`, `member_id`),
    KEY `idx_member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息已读记录表';
```

### 7.3 公告表 (wedding_notice)

```sql
CREATE TABLE `wedding_notice` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `title` varchar(255) NOT NULL DEFAULT '' COMMENT '公告标题',
    `content` text COMMENT '公告内容',
    `cover` varchar(500) NOT NULL DEFAULT '' COMMENT '封面图',
    `link_type` varchar(50) NOT NULL DEFAULT '' COMMENT '链接类型：url/none',
    `link_url` varchar(500) NOT NULL DEFAULT '' COMMENT '链接地址',
    `target_type` tinyint(1) NOT NULL DEFAULT 0 COMMENT '目标用户：0=所有用户，1=普通用户，2=主持人',
    `is_top` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否置顶：0=否，1=是',
    `top_time` int(11) NOT NULL DEFAULT 0 COMMENT '置顶时间',
    `view_count` int(10) NOT NULL DEFAULT 0 COMMENT '查看次数',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=启用',
    `publish_time` int(11) NOT NULL DEFAULT 0 COMMENT '发布时间',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_status` (`status`),
    KEY `idx_publish_time` (`publish_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='公告表';
```

### 7.4 轮播图表 (wedding_banner)

```sql
CREATE TABLE `wedding_banner` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `title` varchar(255) NOT NULL DEFAULT '' COMMENT '标题',
    `image` varchar(500) NOT NULL DEFAULT '' COMMENT '图片地址',
    `link_type` varchar(50) NOT NULL DEFAULT '' COMMENT '链接类型：url/host/dynamic/none',
    `link_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '链接ID',
    `link_url` varchar(500) NOT NULL DEFAULT '' COMMENT '链接地址',
    `position` varchar(50) NOT NULL DEFAULT 'home' COMMENT '位置：home/index/host_detail',
    `sort` int(10) NOT NULL DEFAULT 0 COMMENT '排序',
    `status` tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态：0=禁用，1=启用',
    `start_time` int(11) NOT NULL DEFAULT 0 COMMENT '开始时间',
    `end_time` int(11) NOT NULL DEFAULT 0 COMMENT '结束时间',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    `update_time` int(11) NOT NULL DEFAULT 0 COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_position` (`position`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='轮播图表';
```

### 7.5 分享记录表 (wedding_share_log)

```sql
CREATE TABLE `wedding_share_log` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `member_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '分享人ID',
    `share_type` varchar(50) NOT NULL DEFAULT '' COMMENT '分享类型：host/dynamic/order',
    `share_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '分享对象ID',
    `share_channel` varchar(50) NOT NULL DEFAULT '' COMMENT '分享渠道：wechat/friend/moments',
    `share_count` int(10) NOT NULL DEFAULT 1 COMMENT '分享次数',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_member_id` (`member_id`),
    KEY `idx_share_type` (`share_type`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='分享记录表';
```

### 7.6 订单超时日志表 (wedding_order_timeout_log)

```sql
CREATE TABLE `wedding_order_timeout_log` (
    `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `order_id` int(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '订单ID',
    `order_no` varchar(32) NOT NULL DEFAULT '' COMMENT '订单编号',
    `timeout_type` varchar(50) NOT NULL DEFAULT '' COMMENT '超时类型：pending_timeout/payment_timeout',
    `timeout_hours` int(10) NOT NULL DEFAULT 0 COMMENT '超时小时数',
    `old_status` tinyint(2) NOT NULL DEFAULT 0 COMMENT '原状态',
    `new_status` tinyint(2) NOT NULL DEFAULT 0 COMMENT '新状态',
    `action` varchar(50) NOT NULL DEFAULT '' COMMENT '处理动作：auto_reject/auto_cancel/notify',
    `remark` varchar(500) NOT NULL DEFAULT '' COMMENT '备注',
    `create_time` int(11) NOT NULL DEFAULT 0 COMMENT '创建时间',
    PRIMARY KEY (`id`),
    KEY `idx_order_id` (`order_id`),
    KEY `idx_timeout_type` (`timeout_type`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单超时日志表';
```

---

## 八、字典常量

### 7.1 场次类型 (PeriodType)

```php
class PeriodType
{
    const MORNING = 1;    // 早司仪
    const NOON = 2;       // 午宴
    const EVENING = 3;    // 晚宴
    const FULL_DAY = 4;   // 全天
    
    public static function getList(): array
    {
        return [
            self::MORNING => '早司仪',
            self::NOON => '午宴',
            self::EVENING => '晚宴',
            self::FULL_DAY => '全天'
        ];
    }
}
```

### 7.2 订单状态 (OrderStatus)

```php
class OrderStatus
{
    const PENDING = 0;         // 待审核
    const APPROVED = 1;        // 已同意
    const PAID = 2;            // 已付款
    const WAIT_SERVICE = 3;    // 待服务
    const COMPLETED = 4;       // 已完成
    const REFUNDING = 5;       // 退款审核中
    const REJECTED = -1;       // 已拒绝
    const CANCELLED = -2;      // 已取消
    const REFUNDED = -3;       // 已退款
    
    public static function getList(): array
    {
        return [
            self::PENDING => '待审核',
            self::APPROVED => '已同意',
            self::PAID => '已付款',
            self::WAIT_SERVICE => '待服务',
            self::COMPLETED => '已完成',
            self::REFUNDING => '退款审核中',
            self::REJECTED => '已拒绝',
            self::CANCELLED => '已取消',
            self::REFUNDED => '已退款'
        ];
    }
}
```

### 7.3 档期状态 (ScheduleStatus)

```php
class ScheduleStatus
{
    const FREE = 0;       // 空闲
    const REST = 1;       // 休息
    const BOOKED = 2;     // 已预订
    
    public static function getList(): array
    {
        return [
            self::FREE => '空闲',
            self::REST => '休息',
            self::BOOKED => '已预订'
        ];
    }
}
```

### 7.4 服务类型 (ServiceType)

```php
class ServiceType
{
    const PACKAGE = 1;    // 基础套餐
    const ADDON = 2;      // 增值服务
    
    public static function getList(): array
    {
        return [
            self::PACKAGE => '基础套餐',
            self::ADDON => '增值服务'
        ];
    }
}
```

---

## 九、索引设计

### 9.1 索引策略

1. **主键索引**: 所有表使用自增ID作为主键
2. **唯一索引**: 订单编号、用户OpenID等需要唯一性保证的字段
3. **普通索引**: 常用查询字段、外键字段
4. **联合索引**: 组合查询条件（最左前缀原则）
5. **前缀索引**: 用于长文本字段（如label_ids）

### 9.2 服务提供者表索引

```sql
-- 服务提供者表索引
ALTER TABLE `wedding_service_provider` 
ADD INDEX `idx_service_type_status` (`service_type`, `status`),
ADD INDEX `idx_service_type_sort` (`service_type`, `sort`),
ADD INDEX `idx_service_type_score` (`service_type`, `avg_score`),
ADD INDEX `idx_service_type_order_count` (`service_type`, `order_count`),
ADD INDEX `idx_label_ids` (`label_ids`(100));  -- 前缀索引，用于标签搜索
```

**索引说明**:
- `idx_service_type_status`: 用于按服务类型和状态筛选（最常用）
- `idx_service_type_sort`: 用于按服务类型排序
- `idx_service_type_score`: 用于按评分排序
- `idx_service_type_order_count`: 用于按订单量排序
- `idx_label_ids`: 前缀索引，用于标签搜索（MySQL 5.7+支持）

### 9.3 订单表索引

```sql
-- 订单表索引
ALTER TABLE `wedding_order`
ADD INDEX `idx_service_type_status` (`service_type`, `order_status`),
ADD INDEX `idx_provider_status` (`provider_id`, `order_status`),
ADD INDEX `idx_member_status` (`member_id`, `order_status`),
ADD INDEX `idx_date_status` (`reservation_date`, `order_status`),
ADD INDEX `idx_create_time_status` (`create_time`, `order_status`);  -- 用于超时查询
```

**索引说明**:
- `uk_order_no`: 订单编号唯一索引，用于订单号查询
- `idx_service_type_status`: 管理端按服务类型和状态筛选
- `idx_provider_status`: 服务提供者查看自己的订单
- `idx_member_status`: 用户查看自己的订单
- `idx_date_status`: 按日期和状态查询
- `idx_create_time_status`: 用于订单超时查询（重要）

### 9.4 档期表索引

```sql
-- 档期表索引
ALTER TABLE `wedding_service_provider_schedule`
ADD INDEX `idx_provider_date` (`provider_id`, `date`),
ADD INDEX `idx_date_status` (`date`, `status`),
ADD INDEX `idx_date_period_status` (`date`, `period`, `status`);  -- 用于档期查询
```

**索引说明**:
- `uk_provider_date_period`: 服务提供者+日期+场次联合唯一索引，防止重复预订
- `idx_provider_date`: 用于查询某个服务提供者的档期
- `idx_date_status`: 用于按日期和状态查询
- `idx_date_period_status`: 用于档期查询（最常用）

### 9.5 评价表索引

```sql
-- 评价表索引
ALTER TABLE `wedding_review`
ADD INDEX `idx_service_type_provider` (`service_type`, `provider_id`),
ADD INDEX `idx_provider_status` (`provider_id`, `status`),
ADD INDEX `idx_create_time` (`create_time`);
```

### 9.6 动态表索引

```sql
-- 动态表索引
ALTER TABLE `wedding_dynamic`
ADD INDEX `idx_service_type_status` (`service_type`, `status`),
ADD INDEX `idx_provider_status` (`provider_id`, `status`),
ADD INDEX `idx_category_status` (`category_id`, `status`),
ADD INDEX `idx_create_time_status` (`create_time`, `status`);  -- 用于列表排序
```

### 9.7 索引使用建议

1. **避免过度索引**: 每个表索引数量控制在5-8个以内
2. **联合索引顺序**: 按照查询频率和选择性排序
3. **前缀索引**: 对于长文本字段（如label_ids），使用前缀索引
4. **定期分析**: 使用`EXPLAIN`分析查询计划，优化慢查询

---

## 十、数据迁移脚本

### 10.1 从wedding_host迁移到wedding_service_provider

**说明**: 如果已有`wedding_host`表数据，需要迁移到`wedding_service_provider`表

```sql
-- 步骤1: 迁移数据
INSERT INTO `wedding_service_provider` (
    `member_id`, `service_type`, `provider_no`, `realname`, `mobile`, 
    `wechat`, `headimg`, `cover`, `sex`, `birthday`, `id_card`,
    `signature`, `introduction`, `label_ids`, `experience_years`,
    `diy_page_id`, `status`, `sort`, `order_count`, `review_count`,
    `avg_score`, `remark`, `create_time`, `update_time`, `is_deleted`
)
SELECT 
    `member_id`, 'host', `host_no`, `realname`, `mobile`,
    `wechat`, `headimg`, `cover`, `sex`, `birthday`, `id_card`,
    `signature`, `introduction`, `label_ids`, `experience_years`,
    `diy_page_id`, `status`, `sort`, `order_count`, `review_count`,
    `avg_score`, `remark`, `create_time`, `update_time`, `is_deleted`
FROM `wedding_host`
WHERE `is_deleted` = 0;

-- 步骤2: 更新订单表中的provider_id（如果订单表使用的是host_id）
-- 注意：需要根据实际情况调整
UPDATE `wedding_order` o
INNER JOIN `wedding_service_provider` p ON o.host_id = p.id AND p.service_type = 'host'
SET o.provider_id = p.id
WHERE o.provider_id = 0;

-- 步骤3: 验证数据迁移结果
SELECT 
    (SELECT COUNT(*) FROM `wedding_host` WHERE `is_deleted` = 0) as old_count,
    (SELECT COUNT(*) FROM `wedding_service_provider` WHERE `service_type` = 'host') as new_count;

-- 步骤4: 确认数据无误后，删除旧表（谨慎操作！）
-- DROP TABLE IF EXISTS `wedding_host`;
```

### 10.2 初始化脚本

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS Wedding_management 
DEFAULT CHARACTER SET utf8mb4 
DEFAULT COLLATE utf8mb4_general_ci;

USE Wedding_management;

-- 执行建表语句（参考上述表结构）

-- 插入初始数据
INSERT INTO `wedding_admin` (`username`, `password`, `realname`, `role`, `status`, `create_time`) 
VALUES ('admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', '管理员', 'super_admin', 1, UNIX_TIMESTAMP());

INSERT INTO `wedding_config` (`key`, `value`, `description`, `create_time`) VALUES 
('basic_config', '{"site_name":"婚庆管家","site_logo":""}', '基础配置', UNIX_TIMESTAMP()),
('order_config', '{"auto_cancel_hours":24}', '订单配置', UNIX_TIMESTAMP()),
('review_config', '{"need_audit":false}', '评价配置', UNIX_TIMESTAMP()),
('dynamic_config', '{"need_audit":true}', '动态配置', UNIX_TIMESTAMP());

-- 插入默认标签（按服务类型，仅管理员可管理）
-- 主持人标签
INSERT INTO `wedding_service_provider_label` (`service_type`, `name`, `icon`, `color`, `sort`, `status`, `create_time`) VALUES 
('host', '资深主持', '', '#FF6600', 1, 1, UNIX_TIMESTAMP()),
('host', '婚礼策划', '', '#4ECDC4', 2, 1, UNIX_TIMESTAMP()),
('host', '双语主持', '', '#45B7D1', 3, 1, UNIX_TIMESTAMP()),
('host', '户外婚礼', '', '#96CEB4', 4, 1, UNIX_TIMESTAMP()),
('host', '中式婚礼', '', '#FFEAA7', 5, 1, UNIX_TIMESTAMP()),
('host', '西式婚礼', '', '#DDA0DD', 6, 1, UNIX_TIMESTAMP());

-- 跟拍标签
INSERT INTO `wedding_service_provider_label` (`service_type`, `name`, `icon`, `color`, `sort`, `status`, `create_time`) VALUES 
('photographer', '单机位', '', '#0066FF', 1, 1, UNIX_TIMESTAMP()),
('photographer', '双机位', '', '#0099FF', 2, 1, UNIX_TIMESTAMP()),
('photographer', '多机位', '', '#00CCFF', 3, 1, UNIX_TIMESTAMP()),
('photographer', '航拍', '', '#00FFFF', 4, 1, UNIX_TIMESTAMP()),
('photographer', '纪实风格', '', '#FF6600', 5, 1, UNIX_TIMESTAMP()),
('photographer', '唯美风格', '', '#FF99CC', 6, 1, UNIX_TIMESTAMP());

-- 管家标签
INSERT INTO `wedding_service_provider_label` (`service_type`, `name`, `icon`, `color`, `sort`, `status`, `create_time`) VALUES 
('butler', '迎宾服务', '', '#66CC99', 1, 1, UNIX_TIMESTAMP()),
('butler', '现场协调', '', '#99CC66', 2, 1, UNIX_TIMESTAMP()),
('butler', '收尾服务', '', '#CC9966', 3, 1, UNIX_TIMESTAMP()),
('butler', '全程服务', '', '#9966CC', 4, 1, UNIX_TIMESTAMP());

-- 插入默认动态分类
INSERT INTO `wedding_dynamic_category` (`name`, `sort`, `status`, `create_time`) VALUES 
('婚礼现场', 1, 1, UNIX_TIMESTAMP()),
('幕后花絮', 2, 1, UNIX_TIMESTAMP()),
('新人好评', 3, 1, UNIX_TIMESTAMP()),
('行业资讯', 4, 1, UNIX_TIMESTAMP());
```

---

## 十一、架构优化说明

### 11.1 数据库设计优化

**统一表设计**: 不保留`wedding_host`表，统一使用`wedding_service_provider`表管理所有服务类型。

**理由**:
- 避免数据冗余和维护成本
- 统一数据模型，简化业务逻辑
- 便于扩展新的服务类型

**数据迁移**: 如果已有`wedding_host`表数据，需要迁移到`wedding_service_provider`表（service_type='host'），迁移完成后删除旧表。

### 11.2 索引优化说明

所有索引设计已在第九章详细说明，关键索引包括：

**服务提供者表**:
- `idx_service_type_status`: 按服务类型和状态筛选（最常用）
- `idx_service_type_sort`: 按服务类型排序
- `idx_service_type_score`: 按评分排序

**订单表**:
- `idx_create_time_status`: 用于订单超时查询（重要）
- `idx_service_type_status`: 管理端按服务类型筛选

**档期表**:
- `uk_provider_date_period`: 防止重复预订
- `idx_date_period_status`: 用于档期查询

### 11.3 索引使用建议

1. **避免过度索引**: 每个表索引数量控制在5-8个以内
2. **联合索引顺序**: 按照查询频率和选择性排序
3. **前缀索引**: 对于长文本字段（如label_ids），使用前缀索引
4. **定期分析**: 使用`EXPLAIN`分析查询计划，优化慢查询

---

**文档版本**: v1.0.0  
**最后更新**: 2025-01-01

